---
title: "p8105_hw3_yw3236"
output: github_document
author: "Yishan Wang"
date: 2018-10-15
---

# Problem 1

```{r set up library, include = FALSE}
library(tidyverse)
library(dplyr)
```

```{r}
devtools::install_github("p8105/p8105.datasets")
```

```{r}
library(p8105.datasets)
data(brfss_smart2010) 
```

### Clean Data

* Format the data to use appropriate variable names
* Focus on the “Overall Health” topic
* Include only responses from “Excellent” to “Poor”
* Organize responses as a factor taking levels ordered from “Excellent” to “Poor”

```{r}
formated_brfss_smart2010 = brfss_smart2010 %>%
  janitor::clean_names() %>%
  rename(., state = locationabbr, county = locationdesc) %>%
  filter(., topic == "Overall Health") %>%
  filter(., response == "Excellent" | response == "Very good" | response == "Good" | response == "Fair" | response == "Poor") %>%
  mutate(., factor(response, levels = c("Excellent", "Very good", "Good", "Fair", "Poor")))

formated_brfss_smart2010
```

### Question 1

```{r}
formated_brfss_smart2010_2002 = formated_brfss_smart2010 %>%
  filter(., year == "2002") %>%
  select(., year, state, county) %>%
  unique(.) %>%
  group_by(state) %>%
  summarize(n = n())
```

In 2002, CT, FL, NC were observed at 7 locations.

### Question 2

Make a “spaghetti plot” that shows the number of locations in each state from 2002 to 2010.

```{r}
plot_2002_to_2010 = formated_brfss_smart2010 %>%
  select(., year, state) %>%
  group_by(year, state) %>%
  summarize(n_location = n())

  ggplot(plot_2002_to_2010, aes(x = year, y = n_location, color = state)) +
  geom_line() +
  labs(x = "Year", y = "Number of Locations")

plot_2002_to_2010
```

There are many lines in the plot, just like "spaghetti". It's kind of difficult to read information from this plot.

### Question 3

Make a table showing, for the years 2002, 2006, and 2010, the mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.

```{r}
formated_brfss_smart2010_excellent_NY = formated_brfss_smart2010 %>%
  filter(., year == "2002" | year == "2006" | year == "2010") %>%
  filter(., state == "NY") %>%
  select(., year, state, county, response, data_value) %>%
  arrange(., year, county) %>%
  filter(., response == "Excellent") %>%
  group_by(year) %>%
  summarise(mean_ny_excellent = mean(data_value), std_ny_excellent = sqrt(var(data_value))) %>%
  knitr::kable(digits = 1) 

formated_brfss_smart2010_excellent_NY
```

From the table, we can see that year 2002 has the highest mean and standard deviation of the proportion of “Excellent” responses across locations in NY State.

### Question 4

* For each year and state, compute the average proportion in each response category. * Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.

```{r}
response_average_prop = formated_brfss_smart2010 %>%
  select(., year, state, county, response, data_value) %>%
  group_by(year, state, response) %>%
  summarise(average_prop = mean(data_value))

response_average_prop

ggplot(response_average_prop, aes(x = year, y = average_prop)) +
  geom_point() +
  facet_grid(~response)
```

For the **excellent** response, the average proportion of it from 2002 to 2010 is approximatelly between 15% and 30 %. For the **very good** response, the average proportion of it from 2002 to 2010 is approximatelly between 25% and 40%. For the **good** response, the average proportion of it from 2002 to 2010 is approximatelly between 25% and 35%. For the **fair** response, the average proportion of it from 2002 to 2010 is approximatelly between 5% and 15%. For the **poor** response, the average proportion of it from 2002 to 2010 is approximatelly between 0% and 10%.

# Problem 2

```{r}
data(instacart)
```

#### Description of the Dataset

The dataset is about instacart company sale information. The size of the dataset is 1,384,617 x 15. The structure of the dataset is ready for the analysis. The key variables are `order_dow`, `order_hour_of_day`, `product_name`, `aisle`. Each observation includes custmers' information, ordered products' imformation. 

### Question 1

```{r}
n_aisles = nrow(instacart %>%
  select(., aisle) %>%
  unique(.))

n_aisles

most_order_aisles = instacart %>%
  select(., aisle, product_id) %>%
  arrange(., aisle, product_id) %>%
  group_by(aisle) %>%
  summarise(item_num = n()) %>%
  arrange(., item_num) %>%
  tail(5)

most_order_aisles
```

There are 134 aisles there. The most items ordered from fresh vegetables aisle.

